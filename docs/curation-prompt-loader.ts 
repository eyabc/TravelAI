// ğŸ“¦ YAML ê¸°ë°˜ íë ˆì´ì…˜ í”„ë¡¬í”„íŠ¸ ë¡œë”
// ì‚¬ìš©ìì˜ ì˜ì–´ ì…ë ¥ê³¼ ì •ì˜ëœ ê·œì¹™ì„ ë§¤ì¹­í•˜ì—¬ GPTìš© í”„ë¡¬í”„íŠ¸ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

import * as fs from 'fs';
import * as path from 'path';
import * as yaml from 'js-yaml';

type PromptRule = {
  if_input: string;
  then_gpt_prompt: string;
};

type CurationPromptSet = {
  prompts: PromptRule[];
  metadata?: {
    version?: string;
    updated_at?: string;
  };
};

export class CurationPromptLoader {
  private prompts: PromptRule[] = [];

  constructor(yamlFilePath: string) {
    const file = fs.readFileSync(path.resolve(yamlFilePath), 'utf8');
    const parsed = yaml.load(file) as CurationPromptSet;
    this.prompts = parsed.prompts || [];
  }

  /**
   * ì˜ì–´ë¡œ ë²ˆì—­ëœ ì‚¬ìš©ì ì…ë ¥ê³¼ ê°€ì¥ ì˜ ë§ëŠ” í”„ë¡¬í”„íŠ¸ ê·œì¹™ì„ ì°¾ëŠ”ë‹¤.
   * @param englishInput ì‚¬ìš©ì ì…ë ¥ (ì´ë¯¸ ì˜ì–´ë¡œ ë²ˆì—­ë¨)
   */
  findPrompt(englishInput: string): string | null {
    const normalizedInput = englishInput.toLowerCase().trim();

    for (const rule of this.prompts) {
      if (normalizedInput.includes(rule.if_input.toLowerCase())) {
        return rule.then_gpt_prompt;
      }
    }

    return null;
  }
}

// ì‚¬ìš© ì˜ˆì‹œ:
// const loader = new CurationPromptLoader('config/curation-prompts/default.yaml');
// const prompt = loader.findPrompt("I'm traveling alone");
// console.log(prompt);